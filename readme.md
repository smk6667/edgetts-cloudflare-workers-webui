# é«˜æ€§èƒ½ Edge TTS Cloudflare Worker ä»£ç†

è¿™æ˜¯ä¸€ä¸ªéƒ¨ç½²åœ¨ Cloudflare Workers ä¸Šçš„é«˜æ€§èƒ½æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰ä»£ç†æœåŠ¡ã€‚å®ƒå·§å¦™åœ°å°†å¾®è½¯ Edge å¼ºå¤§ä¸”è‡ªç„¶çš„è¯­éŸ³åˆæˆæœåŠ¡ï¼Œå°è£…æˆäº†ä¸€ä¸ªå…¼å®¹ OpenAI API æ ¼å¼çš„æ¥å£ã€‚è¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥æ— ç¼åœ°å°†å„ç§ç°æœ‰åº”ç”¨å¯¹æ¥åˆ°è¿™ä¸ªå…è´¹ã€é«˜è´¨é‡çš„ TTS æœåŠ¡ä¸Šã€‚

é¡¹ç›®åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼š

1.  `workers.js`: éƒ¨ç½²åœ¨ Cloudflare ä¸Šçš„æ ¸å¿ƒæœåŠ¡è„šæœ¬ã€‚
2.  `webui.html`: ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„æœ¬åœ°ç½‘é¡µï¼Œç”¨äºæ–¹ä¾¿åœ°æµ‹è¯•å’Œè°ƒç”¨æœåŠ¡ã€‚

---

## âœ¨ åŠŸèƒ½äº®ç‚¹

- **ğŸš€ OpenAI å…¼å®¹**: å®Œå…¨æ¨¡æ‹Ÿ OpenAI çš„ `/v1/audio/speech` æ¥å£ï¼Œå¯è¢«å®˜æ–¹çš„ OpenAI SDK æˆ–ä»»ä½•ç°æœ‰å·¥å…·ç›´æ¥è°ƒç”¨ã€‚
- **ğŸ—£ï¸ é«˜è´¨é‡éŸ³è‰²**: åˆ©ç”¨å¾®è½¯ Edge TTS æä¾›çš„å¤šç§è‡ªç„¶ã€æµç•…çš„ç¥ç»ç½‘ç»œè¯­éŸ³ã€‚
- ** STREAMING**: æ”¯æŒ**æµå¼**å’Œ**æ ‡å‡†**ï¼ˆéæµå¼ï¼‰ä¸¤ç§å“åº”æ¨¡å¼ï¼Œæµå¼å“åº”å¯æå¤§é™ä½é•¿æ–‡æœ¬çš„é¦–æ¬¡æ’­æ”¾å»¶è¿Ÿã€‚
- **ğŸ§  æ™ºèƒ½æ–‡æœ¬æ¸…ç†**: å†…ç½®å¼ºå¤§çš„â€œæ–‡æœ¬æ¸…ç†æµæ°´çº¿â€ï¼Œå¯è‡ªåŠ¨å¤„ç†ä» PDF æˆ–ç½‘é¡µå¤åˆ¶çš„æ‚ä¹±æ–‡æœ¬ï¼š
  - ç§»é™¤ Markdown æ ¼å¼ã€‚
  - ç§»é™¤ Emoji è¡¨æƒ…ç¬¦å·ã€‚
  - ç§»é™¤ URL é“¾æ¥ã€‚
  - ç§»é™¤è®ºæ–‡æˆ–æ–‡æ¡£ä¸­çš„å¼•ç”¨æ ‡è®°æ•°å­—ï¼ˆå¦‚ `...æ–‡æœ¬ 1.`ï¼‰ï¼ŒåŒæ—¶ä¿ç•™æœ‰æ„ä¹‰çš„æ•°å­—ï¼ˆå¦‚å¹´ä»½ã€æ•°é‡ï¼‰ã€‚
  - ç§»é™¤æ‰€æœ‰å¤šä½™çš„ç©ºæ ¼å’Œç¡¬æ¢è¡Œï¼Œç¡®ä¿ä¸­æ–‡å¬æ„Ÿè‡ªç„¶è¿è´¯ã€‚
  - æ”¯æŒè‡ªå®šä¹‰å…³é”®è¯è¿‡æ»¤ã€‚
- **ğŸ›ï¸ çµæ´»çš„å‚æ•°é…ç½®**: æ”¯æŒé€šè¿‡ API è¯·æ±‚åŠ¨æ€è°ƒæ•´æ‰€æœ‰æ ¸å¿ƒå‚æ•°ï¼ŒåŒ…æ‹¬éŸ³è‰²ã€è¯­é€Ÿã€éŸ³è°ƒã€åˆ†å—å¤§å°ã€å¹¶å‘æ•°ä»¥åŠæ‰€æœ‰æ¸…ç†é€‰é¡¹ã€‚
- **ğŸŒ é›¶ä¾èµ–éƒ¨ç½²**: è„šæœ¬å®Œå…¨è‡ªåŒ…å«ï¼Œæ— éœ€é…ç½® KVã€é˜Ÿåˆ—ç­‰ä»»ä½•å¤–éƒ¨æœåŠ¡ï¼Œéƒ¨ç½²è¿‡ç¨‹æå…¶ç®€å•ã€‚
- **ğŸ’» ä¾¿æ·çš„æµ‹è¯•å·¥å…·**: æä¾›ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„ `webui.html`ï¼Œè®©ç”¨æˆ·æ— éœ€ç¼–å†™ä»»ä½•ä»£ç å³å¯æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ã€‚

---

## ğŸš€ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

è¿™ä¸ª Worker è„šæœ¬æ‰®æ¼”äº†ä¸€ä¸ªæ™ºèƒ½â€œä¸­é—´äººâ€çš„è§’è‰²ã€‚

1.  **æ¥æ”¶è¯·æ±‚**: å®ƒæ¥æ”¶ä¸€ä¸ªæ ¼å¼ä¸ OpenAI TTS API å®Œå…¨ç›¸åŒçš„ `POST` è¯·æ±‚ã€‚
2.  **æ–‡æœ¬é¢„å¤„ç†**: å®ƒä¼šç«‹å³è¿è¡Œå¼ºå¤§çš„æ–‡æœ¬æ¸…ç†æµæ°´çº¿ï¼Œå¯¹è¾“å…¥çš„æ–‡æœ¬è¿›è¡Œå‡€åŒ–ï¼Œä»¥è¾¾åˆ°æœ€ä½³çš„å¬æ„Ÿã€‚
3.  **æ™ºèƒ½å†³ç­–**: å®ƒä¼šå¿«é€Ÿé¢„ä¼°å¤„ç†è¿™æ®µæ–‡æœ¬æ‰€éœ€çš„èµ„æºã€‚
    - **çŸ­æ–‡æœ¬**: å¦‚æœæ–‡æœ¬é•¿åº¦åœ¨å®‰å…¨èŒƒå›´å†…ï¼Œå®ƒä¼šé‡‡ç”¨æœ€é«˜æ•ˆçš„â€œç›´æ¥åŒæ­¥æ¨¡å¼â€è¿›è¡Œå¤„ç†ã€‚
    - **è¶…é•¿æ–‡æœ¬**: å¦‚æœæ–‡æœ¬é•¿åº¦å¯èƒ½è§¦å‘ Cloudflare çš„å¹³å°é™åˆ¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¯ç”¨â€œè‡ªæˆ‘è°ƒèŠ‚æœºåˆ¶â€ï¼Œé‡æ–°è®¡ç®—å¹¶è°ƒæ•´åˆ†å—ç­–ç•¥ï¼Œä»¥ä¿è¯ä»»åŠ¡ 100%æˆåŠŸã€‚
4.  **åˆ†å—ä¸å¹¶å‘**: å®ƒå°†å¤„ç†å¥½çš„æ–‡æœ¬åˆ†å‰²æˆå¤šä¸ªå°å—ï¼Œå¹¶æ ¹æ®æ‚¨æŒ‡å®šçš„å¹¶å‘æ•°ï¼Œåˆ†æ‰¹æ¬¡åœ°å‘å¾®è½¯ Edge TTS æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚
5.  **è¿”å›ç»“æœ**:
    - **æ ‡å‡†æ¨¡å¼**: ç­‰å¾…æ‰€æœ‰éŸ³é¢‘å—è¿”å›ï¼Œæ‹¼æ¥æˆä¸€ä¸ªå®Œæ•´çš„ MP3 æ–‡ä»¶åä¸€æ¬¡æ€§è¿”å›ã€‚
    - **æµå¼æ¨¡å¼**: åœ¨æ”¶åˆ°ç¬¬ä¸€ä¸ªéŸ³é¢‘å—æ—¶å°±ç«‹å³å¼€å§‹å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œå®ç°ä½å»¶è¿Ÿæ’­æ”¾ã€‚

---

## éƒ¨ç½²æŒ‡å—

éƒ¨ç½²è¿™ä¸ªæœåŠ¡éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ åˆ†é’Ÿã€‚

### å‡†å¤‡å·¥ä½œ

- ä¸€ä¸ª Cloudflare è´¦æˆ·ï¼ˆå…è´¹ç‰ˆå³å¯ï¼‰ã€‚

### æ­¥éª¤ä¸€ï¼šåˆ›å»º Cloudflare Worker

1.  ç™»å½•åˆ°æ‚¨çš„ Cloudflare ä»ªè¡¨æ¿ã€‚
2.  åœ¨å·¦ä¾§èœå•ä¸­ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡» **Workers å’Œ Pages**ã€‚
3.  ç‚¹å‡» **åˆ›å»ºåº”ç”¨ç¨‹åº** -> **åˆ›å»º Worker**ã€‚
4.  ä¸ºæ‚¨çš„ Worker æŒ‡å®šä¸€ä¸ªç‹¬ç‰¹çš„åç§°ï¼ˆä¾‹å¦‚ `my-edge-tts-proxy`ï¼‰ï¼Œè¿™å°†æˆä¸ºæ‚¨ URL çš„ä¸€éƒ¨åˆ†ã€‚
5.  ç‚¹å‡» **éƒ¨ç½²**ã€‚

### æ­¥éª¤äºŒï¼šé…ç½® Worker

1.  Worker åˆ›å»ºæˆåŠŸåï¼Œç‚¹å‡» **é…ç½® Worker** æŒ‰é’®ã€‚
2.  **ç²˜è´´ä»£ç **: åœ¨å·¦ä¾§çš„ç¼–è¾‘å™¨ä¸­ï¼Œåˆ é™¤æ‰€æœ‰ç°æœ‰ä»£ç ï¼Œç„¶åå°† `workers.js` æ–‡ä»¶çš„**å…¨éƒ¨å†…å®¹**å¤åˆ¶å¹¶ç²˜è´´è¿›å»ã€‚
3.  **æ·»åŠ å¯†é’¥**:
    - åœ¨å³ä¾§ï¼Œé€‰æ‹© **è®¾ç½®** -> **å˜é‡**ã€‚
    - åœ¨â€œç¯å¢ƒå˜é‡â€ä¸‹çš„ **æœºå¯†å˜é‡** éƒ¨åˆ†ï¼Œç‚¹å‡» **æ·»åŠ æœºå¯†å˜é‡**ã€‚
    - **å˜é‡åç§°**: è¾“å…¥ `API_KEY`
    - **æœºå¯†å€¼**: è¾“å…¥ä¸€ä¸ªæ‚¨è‡ªå·±è®¾å®šçš„ã€è¶³å¤Ÿå¤æ‚çš„å¯†ç ï¼ˆä¾‹å¦‚ `sk-my-super-secret-key-12345`ï¼‰ã€‚è¿™ä¸ªå€¼å°†æ˜¯æ‚¨è°ƒç”¨ API æ—¶çš„å‡­è¯ã€‚
    - ç‚¹å‡» **åŠ å¯†**ã€‚

### æ­¥éª¤ä¸‰ï¼šéƒ¨ç½²

1.  å®Œæˆä»¥ä¸Šé…ç½®åï¼Œè¿”å›ä»£ç ç¼–è¾‘å™¨é¡µé¢ã€‚
2.  ç‚¹å‡»å³ä¸Šè§’çš„ **ä¿å­˜å¹¶éƒ¨ç½²** æŒ‰é’®ã€‚

æ­å–œï¼æ‚¨çš„ TTS ä»£ç†æœåŠ¡ç°åœ¨å·²ç»å…¨çƒå¯ç”¨äº†ã€‚æ‚¨çš„ API åœ°å€å°±æ˜¯ Worker é¡µé¢ä¸Šæ˜¾ç¤ºçš„ `https://<æ‚¨çš„Workeråç§°>.<æ‚¨çš„å­åŸŸ>.workers.dev`ã€‚

### æ­¥éª¤å››ï¼šä½¿ç”¨ Web UI

1.  å°† `webui.html` æ–‡ä»¶ä¿å­˜åˆ°æ‚¨çš„æœ¬åœ°ç”µè„‘ä¸Šã€‚
2.  ç”¨æ‚¨çš„æµè§ˆå™¨ï¼ˆå¦‚ Chrome, Safariï¼‰ç›´æ¥æ‰“å¼€è¿™ä¸ª HTML æ–‡ä»¶ã€‚
3.  åœ¨é¡µé¢çš„â€œAPI é…ç½®â€éƒ¨åˆ†ï¼Œå¡«å…¥æ‚¨çš„ Worker URL å’Œæ‚¨åˆšæ‰è®¾ç½®çš„ API Keyã€‚
4.  ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°½æƒ…æµ‹è¯•æ‰€æœ‰åŠŸèƒ½äº†ï¼

---

## ğŸ› ï¸ API ä½¿ç”¨æŒ‡å—

### ç«¯ç‚¹

`POST https://<æ‚¨çš„Workeråç§°>.<æ‚¨çš„å­åŸŸ>.workers.dev/v1/audio/speech`

### è®¤è¯

ä½¿ç”¨ `Bearer Token` è®¤è¯æ–¹å¼ã€‚å°†æ‚¨çš„ API Key æ”¾åœ¨ `Authorization` è¯·æ±‚å¤´ä¸­ã€‚

`Authorization: Bearer YOUR_API_KEY`

### è¯·æ±‚ä½“å‚æ•° (`JSON`)

| å‚æ•° (Parameter)            | ç±»å‹ (Type) | é»˜è®¤å€¼ (Default)         | æè¿° (Description)                                                    |
| --------------------------- | ----------- | ------------------------ | --------------------------------------------------------------------- |
| `model`                     | `string`    | `"tts-1"`                | æ¨¡å‹ IDã€‚æ”¯æŒ `tts-1`, `tts-1-hd`ï¼Œæˆ–æ˜ å°„çš„éŸ³è‰²å¦‚ `tts-1-alloy`ã€‚     |
| `input`                     | `string`    | **å¿…éœ€**                 | éœ€è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡æœ¬ã€‚**æ”¯æŒä»»æ„é•¿åº¦**ã€‚                              |
| `voice`                     | `string`    | `"zh-CN-XiaoxiaoNeural"` | ç›´æ¥æŒ‡å®šå¾®è½¯çš„éŸ³è‰²åç§°ã€‚å½“ `model` å‚æ•°æœªè¢«æ˜ å°„æ—¶ç”Ÿæ•ˆã€‚               |
| `speed`                     | `number`    | `1.0`                    | è¯­é€Ÿã€‚èŒƒå›´ä» 0.25 åˆ° 2.0ã€‚                                            |
| `pitch`                     | `number`    | `1.0`                    | éŸ³è°ƒã€‚                                                                |
| `stream`                    | `boolean`   | `false`                  | æ˜¯å¦ä½¿ç”¨æµå¼å“åº”ã€‚è®¾ä¸º `true` å¯æå¤§é™ä½é•¿æ–‡æœ¬çš„é¦–æ¬¡å»¶è¿Ÿã€‚            |
| `concurrency`               | `number`    | `10`                     | å¹¶å‘è¯·æ±‚æ•°ã€‚æ§åˆ¶åŒæ—¶å‘å¾®è½¯æœåŠ¡å™¨å‘é€å¤šå°‘ä¸ªæ–‡æœ¬å—è¯·æ±‚ã€‚                |
| `chunk_size`                | `number`    | `300`                    | æ–‡æœ¬åˆ†å—å¤§å°ï¼ˆå­—ç¬¦æ•°ï¼‰ã€‚Worker ä¼šæ ¹æ®å¹³å°é™åˆ¶è‡ªåŠ¨è°ƒæ•´æ­¤å€¼ä»¥ç¡®ä¿æˆåŠŸã€‚ |
| `cleaning_options`          | `object`    | `{...}`                  | ä¸€ä¸ªåŒ…å«æ–‡æœ¬æ¸…ç†å¼€å…³çš„å¯¹è±¡ã€‚                                          |
| `â”œ remove_markdown`         | `boolean`   | `true`                   | æ˜¯å¦ç§»é™¤ Markdown æ ¼å¼ã€‚                                              |
| `â”œ remove_emoji`            | `boolean`   | `true`                   | æ˜¯å¦ç§»é™¤ Emojiã€‚                                                      |
| `â”œ remove_urls`             | `boolean`   | `true`                   | æ˜¯å¦ç§»é™¤ URLã€‚                                                        |
| `â”œ remove_line_breaks`      | `boolean`   | `true`                   | æ˜¯å¦ç§»é™¤æ‰€æœ‰ç©ºæ ¼å’Œæ¢è¡Œç¬¦ã€‚                                            |
| `â”œ remove_citation_numbers` | `boolean`   | `true`                   | æ˜¯å¦æ™ºèƒ½ç§»é™¤è®ºæ–‡å¼•ç”¨æ ‡è®°ã€‚                                            |
| `â”œ custom_keywords`         | `string`    | `""`                     | è‡ªå®šä¹‰è¦ç§»é™¤çš„å…³é”®è¯ï¼Œä»¥é€—å·åˆ†éš”ã€‚                                    |

### cURL ç¤ºä¾‹

#### 1. æ ‡å‡†è¯·æ±‚

```bash
curl --location 'https://<YOUR_WORKER_URL>/v1/audio/speech' \
--header 'Authorization: Bearer YOUR_API_KEY' \
--header 'Content-Type: application/json' \
--data '{
    "model": "tts-1-alloy",
    "input": "ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„è¯­éŸ³åˆæˆè¯·æ±‚ã€‚"
}' \
--output standard.mp3
```

#### 2. æµå¼è¯·æ±‚ (ç”¨äºé•¿æ–‡æœ¬)

```bash
curl --location 'https://<YOUR_WORKER_URL>/v1/audio/speech' \
--header 'Authorization: Bearer YOUR_API_KEY' \
--header 'Content-Type: application/json' \
--data '{
    "model": "tts-1-nova",
    "input": "è¿™æ˜¯ä¸€ä¸ªæµå¼è¯·æ±‚çš„ç¤ºä¾‹ï¼Œå¯¹äºè¾ƒé•¿çš„æ–‡æœ¬ï¼Œä½ èƒ½æ›´å¿«åœ°å¬åˆ°å£°éŸ³çš„å¼€å¤´éƒ¨åˆ†ã€‚",
    "stream": true
}' \
--output streaming.mp3
```

#### 3. ä½¿ç”¨é«˜çº§è¿‡æ»¤é€‰é¡¹

```bash
curl --location 'https://<YOUR_WORKER_URL>/v1/audio/speech' \
--header 'Authorization: Bearer YOUR_API_KEY' \
--header 'Content-Type: application/json' \
--data '{
    "model": "tts-1-shimmer",
    "input": "è¿™æ®µæ–‡æœ¬åŒ…å« **Markdown** 1ã€ä¸€ä¸ªé“¾æ¥ https://example.com å’Œä¸€ä¸ªè¡¨æƒ… ğŸ˜‚ã€‚",
    "cleaning_options": {
        "remove_markdown": true,
        "remove_urls": true,
        "remove_emoji": true,
        "remove_citation_numbers": true
    }
}' \
--output cleaned.mp3
```

---

## âš ï¸ é‡è¦é™åˆ¶

- **å­—ç¬¦æ•°é™åˆ¶**: æ­¤ç‰ˆæœ¬çš„è„šæœ¬è®¾è®¡ä¸ºåœ¨ **Cloudflare å…è´¹å¥—é¤** ä¸Šç¨³å®šè¿è¡Œã€‚ä¸ºäº†ä¿è¯è¿™ä¸€ç‚¹ï¼Œå¯¹äºå•æ¬¡è¯·æ±‚çš„æ–‡æœ¬é•¿åº¦æœ‰ä¸€ä¸ªéšæ€§çš„ä¸Šé™ï¼Œå¤§çº¦åœ¨ **12 ä¸‡å­—ç¬¦** å·¦å³ (`~50 * 2500`)ã€‚å¯¹äºç»å¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼ˆåŒ…æ‹¬è½¬åŒ–æ•´ç¯‡é•¿æ–‡ï¼‰éƒ½å·²ç»å®Œå…¨è¶³å¤Ÿã€‚è¶…è¿‡è¿™ä¸ªé•¿åº¦ï¼ŒAPI ä¼šè¿”å›ä¸€ä¸ªæ¸…æ™°çš„é”™è¯¯æç¤ºã€‚

---

## ğŸ“„ é¡¹ç›®æ–‡ä»¶è¯´æ˜

- **`workers.js`**: æ ¸å¿ƒæœåŠ¡é€»è¾‘ã€‚åŒ…å«äº† API è·¯ç”±ã€è®¤è¯ã€æ–‡æœ¬æ¸…ç†ã€è‡ªæˆ‘è°ƒèŠ‚æœºåˆ¶ã€ä»¥åŠä¸å¾®è½¯ TTS æœåŠ¡çš„äº¤äº’ã€‚è¿™æ˜¯æ‚¨éœ€è¦éƒ¨ç½²åˆ° Cloudflare çš„å”¯ä¸€æ–‡ä»¶ã€‚
- **`webui.html`**: ä¸€ä¸ªç‹¬ç«‹çš„ã€åŠŸèƒ½å¼ºå¤§çš„ HTML æµ‹è¯•é¡µé¢ã€‚å®ƒæ— éœ€ä»»ä½•æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥åœ¨æœ¬åœ°ç”¨æµè§ˆå™¨æ‰“å¼€ã€‚å®ƒå°è£…äº†æ‰€æœ‰ API å‚æ•°ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç›´è§‚çš„ç•Œé¢æ¥ä¸æ‚¨çš„ Worker æœåŠ¡è¿›è¡Œäº¤äº’ã€‚

---
